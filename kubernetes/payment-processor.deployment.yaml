apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: payment-processor
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: payment-processor
    spec:
      containers:
      - image: brbarnett/payment-processor:latest
        name: payment-processor
        ports:
        - containerPort: 80
        env:
        - name: REDIS_CONNECTION
          value: payment-processor-db:6379
        - name: EXTERNAL_PAYMENT_GATEWAY_URI
          value: http://external-payment-gateway
      - image: brbarnett/amqp-sidecar:latest
        name: amqp-sidecar
        ports:
        - containerPort: 8000
        env:
        - name: RABBITMQ_HOSTNAME
          value: message-broker
        - name: RABBITMQ_USERNAME
          value: rabbitmq
        - name: RABBITMQ_PASSWORD
          value: rabbitmq